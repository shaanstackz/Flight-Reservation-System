import java.util.ArrayList;
import java.util.Random;
import java.util.Map;
import java.util.TreeMap;

public class Flight
{
	//Enum of Status Types
	public enum Status {DELAYED, ONTIME, ARRIVED, INFLIGHT};
	//Enum of Flight Types
	public static enum Type {SHORTHAUL, MEDIUMHAUL, LONGHAUL};
	//Enum of Seat Types
	public static enum SeatType {ECONOMY, FIRSTCLASS, BUSINESS};
	
	//Declare variables
	private String flightNum;
	private String airline;
	private String origin, dest;
	private String departureTime;
	private Status status;
	private int flightDuration;
	protected Aircraft aircraft;
	protected int numPassengers;
	protected Type type;
	protected ArrayList<Passenger> manifest;
	protected Map<String, Passenger> seatMap = new TreeMap<String, Passenger>();
	
	protected Random random = new Random();
	
	//Initialize instance variables to default values
	public Flight()
	{
		this.flightNum = "";
		this.airline = "";
		this.dest = "";
		this.origin = "Toronto";
		this.departureTime = "";
		this.flightDuration = 0;
		this.aircraft = null;
		numPassengers = 0;
		status = Status.ONTIME;
		type = Type.MEDIUMHAUL;
		manifest = new ArrayList<Passenger>();
	}
	
	public Flight(String flightNum)
	{
		this.flightNum = flightNum;
	}
	//Initialize instance variables
	public Flight(String flightNum, String airline, String dest, String departure, int flightDuration, Aircraft aircraft)
	{
		this.flightNum = flightNum;
		this.airline = airline;
		this.dest = dest;
		this.origin = "Toronto";
		this.departureTime = departure;
		this.flightDuration = flightDuration;
		this.aircraft = aircraft;
		numPassengers = 0;
		status = Status.ONTIME;
		type = Type.MEDIUMHAUL;
		manifest = new ArrayList<Passenger>();
	}
	//Return Flight Type
	public Type getFlightType()
	{
		return type;
	}
	//Return Flight Number
	public String getFlightNum()
	{
		return flightNum;
	}
	//Set Flight Number
	public void setFlightNum(String flightNum)
	{
		this.flightNum = flightNum;
	}
	//Return Airline
	public String getAirline()
	{
		return airline;
	}
	//Set airline
	public void setAirline(String airline)
	{
		this.airline = airline;
	}
	//Return Origin of Flight
	public String getOrigin()
	{
		return origin;
	}
	//Set Origin of Flight
	public void setOrigin(String origin)
	{
		this.origin = origin;
	}
	//Return Destination of Flight
	public String getDest()
	{
		return dest;
	}
	//Set Destination of Flight
	public void setDest(String dest)
	{
		this.dest = dest;
	}
	//Return departure time 
	public String getDepartureTime()
	{
		return departureTime;
	}
	//Set departure time
	public void setDepartureTime(String departureTime)
	{
		this.departureTime = departureTime;
	}
	//Return flight status
	public Status getStatus()
	{
		return status;
	}
	//Set flight status
	public void setStatus(Status status)
	{
		this.status = status;
	}
	//Return flight duration
	public int getFlightDuration()
	{
		return flightDuration;
	}
	//Set flight duration
	public void setFlightDuration(int dur)
	{
		this.flightDuration = dur;
	}
	//Return number of passengers
	public int getNumPassengers()
	{
		return numPassengers;
	}
	//Set number of passengers
	public void setNumPassengers(int numPassengers)
	{
		this.numPassengers = numPassengers;
	}
	//Assign passenger seat
	public void assignSeat(Passenger p)
	{
		int seat = random.nextInt(aircraft.numEconomySeats);
		p.setSeat("ECO"+ seat);
	}
	//Find last assigned seat
	public String getLastAssignedSeat()
	{
		if (!manifest.isEmpty())
			return manifest.get(manifest.size()-1).getSeat();
		return "";
	}
	//Return flight manifest
	public ArrayList<Passenger> getManifest(){
		return manifest;
	}
	//Find seats available on the flight
	public boolean seatsAvailable(String seatType)
	{
		if (!seatType.equalsIgnoreCase("ECO")) return false;
		return numPassengers < aircraft.numEconomySeats;
	}
	//Equals method to determine equality for flightNum
	public boolean equals(Object other)
	{
		Flight otherFlight = (Flight) other;
		return this.flightNum.equals(otherFlight.flightNum);
	}
	//Display Information
	public String toString()
	{
		 return airline + "\t Flight:  " + flightNum + "\t Dest: " + dest + "\t Departing: " + departureTime + "\t Duration: " + flightDuration + "\t Status: " + status;
	}
	//Reserve seat method
	public void reserveSeat(Passenger passenger) throws Exception{
		//If manifest already contains the same passenger
		if(manifest.contains(passenger)){
			throw new DuplicatePassengerException("Duplicate Passenger " + passenger.getName() + " " + passenger.getPassport());
		}
		//If an occupied seat is selected 
		if(!aircraft.checkSeat(passenger.getSeat())){
			throw new SeatOccupiedException("Seat is currently occupied. Please find a different seat.");
		}
		//Use reserveSeatLayout method in Aircraft to get the seat for a passenger
		aircraft.reserveSeatLayout(passenger.getSeat());
		//Add passenger to manifest
		manifest.add(passenger);
		//Put inputed information to the seatMap
		seatMap.put(passenger.getSeat(),passenger);
		//Increment Passenger count
		numPassengers=numPassengers+1;
	}
	//Cancel Seat method
	public void cancelSeat(String name, String passport, String seat) throws Exception{
		Passenger passenger=new Passenger(name, passport);
		//seat="";
		if(!manifest.contains(passenger)){
			//Passenger could not be found in the manifest
			throw new PassengerNotInManifestException(("Passenger: " + name + " Passport: " + passport + " unidentified"));
		}
		//Remove passenger from manifest
		manifest.remove(passenger);
		//Remove seat from seatMap
		seatMap.remove(seat);
		seatMap.put(seat, null);
		//Use cancelSeatLayout method in aircraft to return seat layout to before
		aircraft.cancelSeatLayout(seat);
		//As long as passengers are greater than 0
		if(numPassengers>0){
			//Decrement passenger count
			numPassengers=numPassengers-1;
		}
		System.out.println("Cancelled!");
	}
	//public void printPassengerManifest(){
		//System.out.println(name + " " + passport + " " + seat);
	//}
	//Print Seats method
	public void printSeats(){
		//Use nested for loop for 2D array
		for(int x=0;x<aircraft.row;x++){
			for(int i=0;i<aircraft.column;i++){
				//Put seatLayout into seatMap
				seatMap.put(aircraft.seatLayout[x][i],null);
				//Display seats
				System.out.print(aircraft.seatLayout[x][i] + " ");
			}
			//Spacing
			System.out.println("");
		}
		//Spacing
		System.out.println("");
		//Legend to show user what certain symbols mean
		System.out.println("\nXX = Occupied + = First Class");
	}
	
}
//DuplicatePassengerException if a duplicate passenger has been inputed
class DuplicatePassengerException extends Exception{
	public DuplicatePassengerException(String errorMessage){
		super(errorMessage);
	}
}
//PassengerNotInManifestException if a passenger not found on the manifest has been inputed
class PassengerNotInManifestException extends Exception{
	public PassengerNotInManifestException(String errorMessage){
		super(errorMessage);
	}
}
//SeatOccupiedException if a seat has already been occupied
class SeatOccupiedException extends Exception{
	public SeatOccupiedException(String errorMessage){
		super(errorMessage);
	}
}
